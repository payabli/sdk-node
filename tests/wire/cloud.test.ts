/**
 * This file was auto-generated by Fern from our API Definition.
 */

import { mockServerPool } from "../mock-server/MockServerPool.js";
import { PayabliClient } from "../../src/Client";

describe("Cloud", () => {
    test("addDevice", async () => {
        const server = mockServerPool.createServer();
        const client = new PayabliClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { registrationCode: "YS7DS5", description: "Front Desk POS" };
        const rawResponseBody = {
            isSuccess: true,
            responseData: "6c361c7d-674c-44cc-b790-382b75d1xxx",
            responseText: "Success",
        };
        server
            .mockEndpoint()
            .post("/Cloud/register/8cfec329267")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.cloud.addDevice("8cfec329267", {
            registrationCode: "YS7DS5",
            description: "Front Desk POS",
        });
        expect(response).toEqual({
            isSuccess: true,
            responseData: "6c361c7d-674c-44cc-b790-382b75d1xxx",
            responseText: "Success",
        });
    });

    test("HistoryDevice", async () => {
        const server = mockServerPool.createServer();
        const client = new PayabliClient({ apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            isSuccess: true,
            responseList: [
                {
                    connected: true,
                    dateRegistered: "2024-03-05T15:56:04Z",
                    deviceId: "36103e24-41d8-47c9-b5f7-119f0000000",
                    deviceNickName: "Front Desk POS",
                    make: "ingenico",
                    model: "LK2500",
                    registered: true,
                    serialNumber: "312345692080000000",
                },
            ],
            responseText: "Success",
        };
        server
            .mockEndpoint()
            .get("/Cloud/history/8cfec329267/WXGDWB")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.cloud.historyDevice("8cfec329267", "WXGDWB");
        expect(response).toEqual({
            isSuccess: true,
            responseList: [
                {
                    connected: true,
                    dateRegistered: "2024-03-05T15:56:04Z",
                    deviceId: "36103e24-41d8-47c9-b5f7-119f0000000",
                    deviceNickName: "Front Desk POS",
                    make: "ingenico",
                    model: "LK2500",
                    registered: true,
                    serialNumber: "312345692080000000",
                },
            ],
            responseText: "Success",
        });
    });

    test("ListDevice", async () => {
        const server = mockServerPool.createServer();
        const client = new PayabliClient({ apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            isSuccess: true,
            responseList: [
                {
                    connected: true,
                    dateRegistered: "2024-03-05T15:56:04Z",
                    deviceId: "36103e24-41d8-47c9-b5f7-119f0000000",
                    deviceNickName: "Front Desk POS",
                    make: "ingenico",
                    model: "LK2500",
                    registered: true,
                    serialNumber: "312345692080000000",
                },
            ],
            responseText: "Success",
        };
        server
            .mockEndpoint()
            .get("/Cloud/list/8cfec329267")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.cloud.listDevice("8cfec329267");
        expect(response).toEqual({
            isSuccess: true,
            responseList: [
                {
                    connected: true,
                    dateRegistered: "2024-03-05T15:56:04Z",
                    deviceId: "36103e24-41d8-47c9-b5f7-119f0000000",
                    deviceNickName: "Front Desk POS",
                    make: "ingenico",
                    model: "LK2500",
                    registered: true,
                    serialNumber: "312345692080000000",
                },
            ],
            responseText: "Success",
        });
    });

    test("RemoveDevice", async () => {
        const server = mockServerPool.createServer();
        const client = new PayabliClient({ apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            isSuccess: true,
            responseData: "6c361c7d-674c-44cc-b790-382b75d1xxx",
            responseText: "Success",
        };
        server
            .mockEndpoint()
            .delete("/Cloud/register/8cfec329267/6c361c7d-674c-44cc-b790-382b75d1xxx")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.cloud.removeDevice("8cfec329267", "6c361c7d-674c-44cc-b790-382b75d1xxx");
        expect(response).toEqual({
            isSuccess: true,
            responseData: "6c361c7d-674c-44cc-b790-382b75d1xxx",
            responseText: "Success",
        });
    });
});
