/**
 * This file was auto-generated by Fern from our API Definition.
 */

import { mockServerPool } from "../mock-server/MockServerPool.js";
import { PayabliClient } from "../../src/Client";

describe("TokenStorage", () => {
    test("AddMethod", async () => {
        const server = mockServerPool.createServer();
        const client = new PayabliClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            customerData: { customerId: 4440 },
            entryPoint: "f743aed24a",
            fallbackAuth: true,
            paymentMethod: {
                cardcvv: "123",
                cardexp: "02/25",
                cardHolder: "John Doe",
                cardnumber: "4111111111111111",
                cardzip: "12345",
                method: "card",
            },
        };
        const rawResponseBody = {
            isSuccess: true,
            responseData: {
                customerId: 4400,
                methodReferenceId: "1ec55af9-7b5a-4ff0-81ed-c12d2f95e135-4440",
                referenceId: "1ec55af9-7b5a-4ff0-81ed-c12d2f95e135-4440",
                resultCode: 1,
                resultText: "Approved",
            },
            responseText: "Success",
        };
        server
            .mockEndpoint()
            .post("/TokenStorage/add")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.tokenStorage.addMethod({
            body: {
                customerData: {
                    customerId: 4440,
                },
                entryPoint: "f743aed24a",
                fallbackAuth: true,
                paymentMethod: {
                    cardcvv: "123",
                    cardexp: "02/25",
                    cardHolder: "John Doe",
                    cardnumber: "4111111111111111",
                    cardzip: "12345",
                    method: "card",
                },
            },
        });
        expect(response).toEqual({
            isSuccess: true,
            responseData: {
                customerId: 4400,
                methodReferenceId: "1ec55af9-7b5a-4ff0-81ed-c12d2f95e135-4440",
                referenceId: "1ec55af9-7b5a-4ff0-81ed-c12d2f95e135-4440",
                resultCode: 1,
                resultText: "Approved",
            },
            responseText: "Success",
        });
    });

    test("GetMethod", async () => {
        const server = mockServerPool.createServer();
        const client = new PayabliClient({ apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            isSuccess: true,
            responseData: {
                aba: "",
                achHolderType: "personal",
                achSecCode: "achSecCode",
                bin: "401288",
                binData: {
                    binMatchedLength: "6",
                    binCardBrand: "Visa",
                    binCardType: "Credit",
                    binCardCategory: "PLATINUM",
                    binCardIssuer: "Bank of Example",
                    binCardIssuerCountry: "United States",
                    binCardIssuerCountryCodeA2: "US",
                    binCardIssuerCountryNumber: "840",
                    binCardIsRegulated: "false",
                    binCardUseCategory: "Consumer",
                    binCardIssuerCountryCodeA3: "USA",
                },
                customers: [
                    {
                        additionalData: { key1: { key: "value" }, key2: { key: "value" }, key3: { key: "value" } },
                        balance: 250,
                        billingPhone: "1234567890",
                        company: "Bluesky Tech Inc",
                        created: "2023-06-01T14:30:00Z",
                        customerId: 1456,
                        customerNumber: "CS789",
                        customerStatus: 1,
                        customerUsername: "Marcus",
                        identifierFields: ["firstname", "email"],
                        lastUpdated: "2024-12-15T09:45:32Z",
                        mfa: true,
                        mfaMode: 1,
                        parentOrgId: 5,
                        parentOrgName: "TechCorp",
                        paypointDbaname: "Bluesky Tech",
                        paypointEntryname: "45782932fcc",
                        paypointLegalname: "Bluesky Technologies LLC",
                        shippingAddress1: "Suite 500",
                        shippingCity: "San Francisco",
                        shippingCountry: "US",
                        shippingState: "CA",
                        shippingZip: "94105",
                        timeZone: -8,
                    },
                ],
                descriptor: "visa",
                expDate: "0926",
                holderName: "Marcus Chen",
                idPmethod: "81f7fde1-dd8b-4892-b2e1-cd60dd91f6b4-XXXC",
                lastUpdated: "2025-01-15T16:30:22Z",
                maskedAccount: "4XXXXXXX2345",
                method: "card",
                methodType: "Single Merchant",
                postalCode: "94105",
            },
            responseText: "Success",
        };
        server
            .mockEndpoint()
            .get("/TokenStorage/32-8877drt00045632-678")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.tokenStorage.getMethod("32-8877drt00045632-678", {
            cardExpirationFormat: 1,
            includeTemporary: false,
        });
        expect(response).toEqual({
            isSuccess: true,
            responseData: {
                aba: "",
                achHolderType: "personal",
                achSecCode: "achSecCode",
                bin: "401288",
                binData: {
                    binMatchedLength: "6",
                    binCardBrand: "Visa",
                    binCardType: "Credit",
                    binCardCategory: "PLATINUM",
                    binCardIssuer: "Bank of Example",
                    binCardIssuerCountry: "United States",
                    binCardIssuerCountryCodeA2: "US",
                    binCardIssuerCountryNumber: "840",
                    binCardIsRegulated: "false",
                    binCardUseCategory: "Consumer",
                    binCardIssuerCountryCodeA3: "USA",
                },
                customers: [
                    {
                        additionalData: {
                            key1: {
                                key: "value",
                            },
                            key2: {
                                key: "value",
                            },
                            key3: {
                                key: "value",
                            },
                        },
                        balance: 250,
                        billingPhone: "1234567890",
                        company: "Bluesky Tech Inc",
                        created: "2023-06-01T14:30:00Z",
                        customerId: 1456,
                        customerNumber: "CS789",
                        customerStatus: 1,
                        customerUsername: "Marcus",
                        identifierFields: ["firstname", "email"],
                        lastUpdated: "2024-12-15T09:45:32Z",
                        mfa: true,
                        mfaMode: 1,
                        parentOrgId: 5,
                        parentOrgName: "TechCorp",
                        paypointDbaname: "Bluesky Tech",
                        paypointEntryname: "45782932fcc",
                        paypointLegalname: "Bluesky Technologies LLC",
                        shippingAddress1: "Suite 500",
                        shippingCity: "San Francisco",
                        shippingCountry: "US",
                        shippingState: "CA",
                        shippingZip: "94105",
                        timeZone: -8,
                    },
                ],
                descriptor: "visa",
                expDate: "0926",
                holderName: "Marcus Chen",
                idPmethod: "81f7fde1-dd8b-4892-b2e1-cd60dd91f6b4-XXXC",
                lastUpdated: "2025-01-15T16:30:22Z",
                maskedAccount: "4XXXXXXX2345",
                method: "card",
                methodType: "Single Merchant",
                postalCode: "94105",
            },
            responseText: "Success",
        });
    });

    test("RemoveMethod", async () => {
        const server = mockServerPool.createServer();
        const client = new PayabliClient({ apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            isSuccess: true,
            responseData: { referenceId: "32-8877drt65345632-678", resultCode: 1, resultText: "Removed" },
            responseText: "Success",
        };
        server
            .mockEndpoint()
            .delete("/TokenStorage/32-8877drt00045632-678")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.tokenStorage.removeMethod("32-8877drt00045632-678");
        expect(response).toEqual({
            isSuccess: true,
            responseData: {
                referenceId: "32-8877drt65345632-678",
                resultCode: 1,
                resultText: "Removed",
            },
            responseText: "Success",
        });
    });

    test("UpdateMethod", async () => {
        const server = mockServerPool.createServer();
        const client = new PayabliClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            customerData: { customerId: 4440 },
            entryPoint: "f743aed24a",
            fallbackAuth: true,
            paymentMethod: {
                cardcvv: "123",
                cardexp: "02/25",
                cardHolder: "John Doe",
                cardnumber: "4111111111111111",
                cardzip: "12345",
                method: "card",
            },
        };
        const rawResponseBody = {
            isSuccess: true,
            responseData: {
                referenceId: "1b502b79-e319-4159-8c29-a9f8d9f105c8-1323",
                resultCode: 1,
                resultText: "Updated",
            },
            responseText: "Success",
        };
        server
            .mockEndpoint()
            .put("/TokenStorage/32-8877drt00045632-678")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.tokenStorage.updateMethod("32-8877drt00045632-678", {
            body: {
                customerData: {
                    customerId: 4440,
                },
                entryPoint: "f743aed24a",
                fallbackAuth: true,
                paymentMethod: {
                    cardcvv: "123",
                    cardexp: "02/25",
                    cardHolder: "John Doe",
                    cardnumber: "4111111111111111",
                    cardzip: "12345",
                    method: "card",
                },
            },
        });
        expect(response).toEqual({
            isSuccess: true,
            responseData: {
                referenceId: "1b502b79-e319-4159-8c29-a9f8d9f105c8-1323",
                resultCode: 1,
                resultText: "Updated",
            },
            responseText: "Success",
        });
    });
});
