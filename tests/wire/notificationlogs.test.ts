/**
 * This file was auto-generated by Fern from our API Definition.
 */

import { mockServerPool } from "../mock-server/MockServerPool.js";
import { PayabliClient } from "../../src/Client";

describe("Notificationlogs", () => {
    test("searchNotificationLogs", async () => {
        const server = mockServerPool.createServer();
        const client = new PayabliClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            startDate: "2024-01-01T00:00:00Z",
            endDate: "2024-01-31T23:59:59Z",
            orgId: 12345,
            notificationEvent: "ActivatedMerchant",
            succeeded: true,
        };
        const rawResponseBody = [
            {
                id: "550e8400-e29b-41d4-a716-446655440000",
                orgId: 12345,
                paypointId: 67890,
                notificationEvent: "ActivatedMerchant",
                target: "https://webhook.example.com/payments",
                responseStatus: "200",
                success: true,
                jobData: '{"transactionId":"txn_123"}',
                createdDate: "2024-01-15T10:30:00Z",
                successDate: "2024-01-15T10:30:05Z",
                lastFailedDate: null,
                isInProgress: false,
            },
        ];
        server
            .mockEndpoint()
            .post("/v2/notificationlogs")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.notificationlogs.searchNotificationLogs({
            PageSize: 20,
            body: {
                startDate: "2024-01-01T00:00:00Z",
                endDate: "2024-01-31T23:59:59Z",
                orgId: 12345,
                notificationEvent: "ActivatedMerchant",
                succeeded: true,
            },
        });
        expect(response).toEqual([
            {
                id: "550e8400-e29b-41d4-a716-446655440000",
                orgId: 12345,
                paypointId: 67890,
                notificationEvent: "ActivatedMerchant",
                target: "https://webhook.example.com/payments",
                responseStatus: "200",
                success: true,
                jobData: '{"transactionId":"txn_123"}',
                createdDate: "2024-01-15T10:30:00Z",
                successDate: "2024-01-15T10:30:05Z",
                lastFailedDate: null,
                isInProgress: false,
            },
        ]);
    });

    test("getNotificationLog", async () => {
        const server = mockServerPool.createServer();
        const client = new PayabliClient({ apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            id: "550e8400-e29b-41d4-a716-446655440000",
            orgId: 12345,
            paypointId: 67890,
            notificationEvent: "ActivatedMerchant",
            target: "https://webhook.example.com/payments",
            responseStatus: "200",
            success: true,
            jobData: '{"transactionId":"txn_123"}',
            createdDate: "2024-01-15T10:30:00Z",
            successDate: "2024-01-15T10:30:05Z",
            lastFailedDate: null,
            isInProgress: false,
            webHeaders: [
                { key: "Content-Type", value: "application/json" },
                { key: "User-Agent", value: "PaymentSystem/1.0" },
            ],
            responseHeaders: [
                { key: "Content-Type", value: ["application/json"] },
                { key: "X-Request-ID", value: ["req_abc123"] },
            ],
            responseContent: '{"status":"received","id":"wh_123"}',
        };
        server
            .mockEndpoint()
            .get("/v2/notificationlogs/550e8400-e29b-41d4-a716-446655440000")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.notificationlogs.getNotificationLog("550e8400-e29b-41d4-a716-446655440000");
        expect(response).toEqual({
            id: "550e8400-e29b-41d4-a716-446655440000",
            orgId: 12345,
            paypointId: 67890,
            notificationEvent: "ActivatedMerchant",
            target: "https://webhook.example.com/payments",
            responseStatus: "200",
            success: true,
            jobData: '{"transactionId":"txn_123"}',
            createdDate: "2024-01-15T10:30:00Z",
            successDate: "2024-01-15T10:30:05Z",
            lastFailedDate: null,
            isInProgress: false,
            webHeaders: [
                {
                    key: "Content-Type",
                    value: "application/json",
                },
                {
                    key: "User-Agent",
                    value: "PaymentSystem/1.0",
                },
            ],
            responseHeaders: [
                {
                    key: "Content-Type",
                    value: ["application/json"],
                },
                {
                    key: "X-Request-ID",
                    value: ["req_abc123"],
                },
            ],
            responseContent: '{"status":"received","id":"wh_123"}',
        });
    });

    test("retryNotificationLog", async () => {
        const server = mockServerPool.createServer();
        const client = new PayabliClient({ apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            id: "550e8400-e29b-41d4-a716-446655440000",
            orgId: 12345,
            paypointId: 67890,
            notificationEvent: "ActivatedMerchant",
            target: "https://webhook.example.com/payments",
            responseStatus: "200",
            success: true,
            jobData: '{"transactionId":"txn_123"}',
            createdDate: "2024-01-15T10:30:00Z",
            successDate: "2024-01-15T10:30:05Z",
            lastFailedDate: null,
            isInProgress: false,
            webHeaders: [{ key: "Content-Type", value: "application/json" }],
            responseHeaders: [{ key: "Content-Type", value: ["application/json"] }],
            responseContent: '{"status":"received","id":"wh_123"}',
        };
        server
            .mockEndpoint()
            .get("/v2/notificationlogs/550e8400-e29b-41d4-a716-446655440000/retry")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.notificationlogs.retryNotificationLog("550e8400-e29b-41d4-a716-446655440000");
        expect(response).toEqual({
            id: "550e8400-e29b-41d4-a716-446655440000",
            orgId: 12345,
            paypointId: 67890,
            notificationEvent: "ActivatedMerchant",
            target: "https://webhook.example.com/payments",
            responseStatus: "200",
            success: true,
            jobData: '{"transactionId":"txn_123"}',
            createdDate: "2024-01-15T10:30:00Z",
            successDate: "2024-01-15T10:30:05Z",
            lastFailedDate: null,
            isInProgress: false,
            webHeaders: [
                {
                    key: "Content-Type",
                    value: "application/json",
                },
            ],
            responseHeaders: [
                {
                    key: "Content-Type",
                    value: ["application/json"],
                },
            ],
            responseContent: '{"status":"received","id":"wh_123"}',
        });
    });

    test("bulkRetryNotificationLogs", async () => {
        const server = mockServerPool.createServer();
        const client = new PayabliClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = [
            "550e8400-e29b-41d4-a716-446655440000",
            "550e8400-e29b-41d4-a716-446655440001",
            "550e8400-e29b-41d4-a716-446655440002",
        ];

        server
            .mockEndpoint()
            .post("/v2/notificationlogs/retry")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .build();

        const response = await client.notificationlogs.bulkRetryNotificationLogs([
            "550e8400-e29b-41d4-a716-446655440000",
            "550e8400-e29b-41d4-a716-446655440001",
            "550e8400-e29b-41d4-a716-446655440002",
        ]);
        expect(response).toEqual(undefined);
    });
});
